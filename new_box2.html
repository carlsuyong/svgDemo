<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		
	</head>

	<body id='body'>
		<link rel="stylesheet" type="text/css" href="css/commen.css"/>
		<script src="js/snap.svg-min.js"></script>
		<script src="js/mqttws31.js"></script>
		<svg id='tsd' viewbox='0 0 1366 768'>
			<defs>

			</defs>
			<polyline class="pipeline" points="10 10,110 10,110 30,10 30,10 10" style="fill:transparent;stroke:gray;stroke-width:1" />
			<polyline class="pipeline" points="10 40,110 40,110 60,10 60,10 40" style="fill:transparent;stroke:gray;stroke-width:1" />
			<text x="15" y="25" font-family="Verdana" font-size="11" fill="gray">室外温度：28℃</text>
			<text x="15" y="55" font-family="Verdana" font-size="11" fill="gray">室外湿度：60%</text>
			<!--左侧三机箱-->
			
			<use x="40" y="-130" width='400' height='800' xlink:href="selectSvg.svg#leanloop-box5-svg" />
			<polyline class="pipeline" points="30 80,175 80,175 200,30 200,30 80" style="fill:transparent;stroke:gray;stroke-width:1" />
			<text x="48" y="192" font-family="Verdana" font-size="10" fill="gray">风冷热泵机组ASHP-R-1</text>
			
			<use x="40" y="80" width='400' height='800' xlink:href="selectSvg.svg#leanloop-box5-svg" />
			<polyline class="pipeline" points="30 290,175 290,175 410,30 410,30 290" style="fill:transparent;stroke:gray;stroke-width:1" />
			<text x="48" y="402" font-family="Verdana" font-size="10" fill="gray">风冷热泵机组ASHP-R-2</text>
			
			<use x="40" y="290" width='400' height='800' xlink:href="selectSvg.svg#leanloop-box5-svg" />
			<polyline class="pipeline" points="30 500,175 500,175 620,30 620,30 500" style="fill:transparent;stroke:gray;stroke-width:1" />
			<text x="48" y="612" font-family="Verdana" font-size="10" fill="gray">风冷热泵机组ASHP-R-3</text>
			
			<polyline class="pipeline" points="365 363,365 110,175 110" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="365 363,365 110,175 110" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="365 378,365 580,175 580" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="365 378,365 580,175 580" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			
			<!--第一-->
			<polyline class="pipeline" points="175 160,285 160,285 363" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="175 160,285 160,285 363" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="285 378,285 573" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="285 378,285 573" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="285 588,285 680,1300 680" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="285 588,285 680,1300 680" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<!--第二-->
			<polyline class="pipeline" points="175 320,285 320" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="175 320,285 320" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="520 370,175 370" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="520 370,175 370" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<!--第三-->
			<polyline class="pipeline" points="175 530,285 530" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="175 530,285 530" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			
			<!--四个阀门-->
			<!--第一个-->
			<polyline class="pipeline" points="670 120,520 120,520 370" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="670 120,520 120,520 370" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="850 370,850 120,700 120" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="850 370,850 120,700 120" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="850 370,850 570,670 570" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="850 370,850 570,670 570" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<!--第四个-->
			<polyline class="pipeline" points="670 570,520 570,520 370" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="670 570,520 570,520 370" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="850 270,710 270" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="850 270,710 270" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<!--第二个-->
			<polyline class="pipeline" points="665 270,520 270" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="665 270,520 270" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="850 420,710 420" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="850 420,710 420" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="1300 370,850 370" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="1300 370,850 370" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="1300 250,1000 250,1000 370" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="1300 250,1000 250,1000 370" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			
			<!--第三个-->
			<polyline class="pipeline" points="665 420,520 420" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="665 420,520 420" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			
			<use x="-1340" y="-100" transform="scale(0.6) rotate(-180,75,75)" xlink:href="selectSvg.svg#leanloop-pumb1-svg" />
			<use x="-1340" y="-350" transform="scale(0.6) rotate(-180,75,75)" xlink:href="selectSvg.svg#leanloop-pumb1-svg" />
			<use x="-1340" y="-600" transform="scale(0.6) rotate(-180,75,75)" xlink:href="selectSvg.svg#leanloop-box3-svg" />
			<use x="-1340" y="-850" transform="scale(0.6) rotate(-180,75,75)" xlink:href="selectSvg.svg#leanloop-pumb2-svg" />
			

			
			
			<!--热水炉-->
			<polyline class="pipeline" points="1150 680,1150 575" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="1150 680,1150 575" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<polyline class="pipeline" points="1150 475,1150 370" style="fill:transparent;stroke:#2A679F;stroke-width:5" />
			<polyline class="water" points="1150 475,1150 370" style="fill:transparent;stroke:#669ccd;stroke-width:5" />
			<use x="1110" y="275" width='400' height='800' xlink:href="selectSvg.svg#leanloop-box2-svg" />
			<polyline class="pipeline" points="1095 475,1205 475,1205 575,1095 575,1095 475" style="fill:transparent;stroke:gray;stroke-width:1" />
			<text x="1100" y="567" font-family="Verdana" font-size="10" fill="gray">⾃动加药装置ECH-1-3</text>
			<!--阀门-->
			<use width="300" x="-228" y="75" transform="rotate(-90, 75, 75)" xlink:href="selectSvg.svg#leanloop-box12-svg"></use>
			<use width="300" x="32" y="75" transform="rotate(-90, 75, 75)" xlink:href="selectSvg.svg#leanloop-box11-svg"></use>
			<use width="300" x="-438" y="75" transform="rotate(-90, 75, 75)" xlink:href="selectSvg.svg#leanloop-box10-svg"></use>
			<!--文字-->
			<text x="1260" y="265" font-family="Verdana" font-size="10" fill="gray">补水</text>
			<text font-family="Verdana" font-size="10" fill="gray">
				<tspan x="1220" y="385">回水</tspan>
				<tspan x="1220" y="400">300-HR-2000</tspan>
			</text>
			<text font-family="Verdana" font-size="10" fill="gray">
				<tspan x="1220" y="695">出水</tspan>
				<tspan x="1220" y="710">300-HS-2000</tspan>
			</text>
			<text x="640" y="165" font-family="Verdana" font-size="10" fill="gray">空调热⽔循环泵HP-1-1</text>
			<text x="640" y="315" font-family="Verdana" font-size="10" fill="gray">空调热⽔循环泵HP-1-2</text>
			<text x="640" y="465" font-family="Verdana" font-size="10" fill="gray">空调热⽔循环泵HP-1-3</text>
			<text x="640" y="615" font-family="Verdana" font-size="10" fill="gray">空调热⽔循环泵HP-1-4</text>
			<!--温度-->
			<polyline points="200 80,260 80,260 100,200 100,200 80" style="fill:none;stroke:#669ccd;stroke-width:1" />
			<text x="205" y="95" font-family="Verdana" font-size="11" fill="gray">100℃</text>
			
			<polyline points="200 170,260 170,260 190,200 190,200 170" style="fill:none;stroke:#669ccd;stroke-width:1" />
			<text x="205" y="185" font-family="Verdana" font-size="11" fill="gray">100℃</text>
			
			<polyline points="200 290,260 290,260 310,200 310,200 290" style="fill:none;stroke:#669ccd;stroke-width:1" />
			<text x="205" y="305" font-family="Verdana" font-size="11" fill="gray">100℃</text>
			
			<polyline points="200 380,260 380,260 400,200 400,200 380" style="fill:none;stroke:#669ccd;stroke-width:1" />
			<text x="205" y="395" font-family="Verdana" font-size="11" fill="gray">100℃</text>
			
			<polyline points="200 500,260 500,260 520,200 520,200 500" style="fill:none;stroke:#669ccd;stroke-width:1" />
			<text x="205" y="515" font-family="Verdana" font-size="11" fill="gray">100℃</text>
			
			<polyline points="200 590,260 590,260 610,200 610,200 590" style="fill:none;stroke:#669ccd;stroke-width:1" />
			<text x="205" y="605" font-family="Verdana" font-size="11" fill="gray">100℃</text>
		</svg>
	</body>
	<script>
		var check = [{
			SequenceNo: 'startLeft1',
			WorkState: 0
		}, {
			SequenceNo: 'startLeft2',
			WorkState: 1
		}, {
			SequenceNo: 'startLeft3',
			WorkState: 0
		}, {
			SequenceNo: 'startLeft4',
			WorkState: 1
		}, {
			SequenceNo: 'startLeft5',
			WorkState: 0
		}, {
			SequenceNo: 'startLeft6',
			WorkState: 1
		}, {
			SequenceNo: 'startLeft7',
			WorkState: 0
		}, {
			SequenceNo: 'startLeft8',
			WorkState: 1
		}, {
			SequenceNo: 'checkBox1',
			WorkState: 0
		}, {
			SequenceNo: 'checkBox2',
			WorkState: 1
		}, {
			SequenceNo: 'checkBox3',
			WorkState: 0
		}, {
			SequenceNo: 'checkBox4',
			WorkState: 1
		}, {
			SequenceNo: 'checkBox5',
			WorkState: 0
		}, {
			SequenceNo: 'checkBox6',
			WorkState: 1
		}, {
			SequenceNo: 'checkBox7',
			WorkState: 0
		}, {
			SequenceNo: 'checkBox8',
			WorkState: 1
		}, {
			SequenceNo: 'switch1',
			WorkState: 1
		}, {
			SequenceNo: 'switch2',
			WorkState: 0
		}, {
			SequenceNo: 'switch3',
			WorkState: 1
		}, {
			SequenceNo: 'switch4',
			WorkState: 1
		}, {
			SequenceNo: 'switch5',
			WorkState: 1
		}]
		console.log('1111', JSON.stringify(check))
		// mqtt接收信息
		var mqttData = ''
		var lastTimeValue = mqttData;
		var wsbroker = "mqtt.leanloop.net"; //mqtt websocket enabled broker
		var wsport = 15675; // port for above

		var client = new Paho.MQTT.Client(wsbroker, wsport, "/ws",
			"myclientid_" + parseInt(Math.random() * 100, 10));

		client.onConnectionLost = function(responseObject) {
			console.log(responseObject.errorMessage)
		};
		// 接收信息返回值
		client.onMessageArrived = function(message) {
			//			console.log('5555',message.payloadString)
			mqttData = JSON.parse(message.payloadString)
			console.log(mqttData)
			for(var i in mqttData) {
				for(var j in check) {
					//1运转  0停止运转
					if(mqttData[i].SequenceNo == check[j].SequenceNo && mqttData[i].WorkState == 1) {
						var checkBox = Snap("#" + mqttData[i].SequenceNo);
						// 判断是否是文本类型
						if(checkBox.type == 'text') {
							console.log(checkBox)
							checkBox.node.innerHTML = '运转正常'
							checkBox.attr({
								fill: '#669ccd'
							})
						} else {
							checkBox.attr({
								'xlink:href': '#leanloop-circle-svg'
							})
						}

					}
					if(mqttData[i].SequenceNo == check[j].SequenceNo && mqttData[i].WorkState == 0) {
						var checkBox = Snap("#" + mqttData[i].SequenceNo);
						// 判断是否是文本类型
						if(checkBox.type == 'text') {
							checkBox.node.innerHTML = '运转故障'
							checkBox.attr({
								fill: 'red'
							})
						} else {
							checkBox.attr({
								'xlink:href': '#leanloop-nocircle-svg',
								fill: 'red'
							})
						}
					}
				}

			}
		};

		var options = {
			timeout: 3,
			userName: "test",
			password: "test",
			onSuccess: function() {
				client.subscribe('home/mqtt', {
					qos: 0
				});
			},
			onFailure: function(message) {
				console.log(message.errorMessage);
			}
		};

		if(location.protocol == "https:") {
			options.useSSL = true;
		}

		client.connect(options);

		//获取svg id
		var svg = Snap("#tsd");
		var myMatrix = new Snap.Matrix();
		var s2 = Snap("#startLeft1");

		//进水箱
		var inletChestLeft = Snap('#inletChestLeft')
		var inletChestRight = Snap('#inletChestRight')

		inletChestRight.mouseover(function() {
			//事件处理代码
			//生成节点
			var c1 = svg.paper.text(960, 25, '这是详情介绍')
			var c2 = svg.paper.rect(950, 0, 300, 200)
			c2.attr({
				fill: 'white',
				fillOpacity: .8,
				stroke: "gray"
			})
			var g = svg.paper.g()
			g.attr({
				id: 'hover'
			})
			g.add(c2, c1)
			//删除节点
			var hover = Snap('#hover')
			hover.mouseout(function() {
				hover.remove()
			})
		});

		inletChestLeft.click(function() {
			//生成节点
			var c1 = svg.paper.text(710, 25, '这是详情介绍')
			var c2 = svg.paper.rect(700, 0, 300, 200)
			c2.attr({
				fill: 'white',
				fillOpacity: .8,
				stroke: "gray"
			})
			var g = svg.paper.g()
			g.attr({
				id: 'hoverHidden'
			})
			g.add(c2, c1)
			//删除节点
			var hoverHidden = Snap('#hoverHidden')
			hoverHidden.click(function() {
				hoverHidden.remove()
			})
		})

		//		s2.click(function() {
		//			var checkBox = Snap("#checkBox1");
		//			checkBox.attr({'xlink:href':'#leanloop-nocircle-svg'})
		//		})
		//		console.log(s1, s2)
		//		var circle_1 = s.circle(200, 200, 140);
		//		var circle_2 = s.circle(150, 200, 140);

		//		var circles = s.group(circle_1, circle_2);
		//
		//		s2.attr({
		//			fill: 'coral',
		//			fillOpacity: .6
		//		});
		//		myMatrix.translate(100,0);
		//		s2.transform(myMatrix)
	</script>

</html>